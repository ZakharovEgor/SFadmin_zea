---
- hosts: all
  become: yes
  tasks:

- name: debian | updating apt-cache
  apt:
    update_cache: true
    cache_valid_time: 86400
  become: true
  register: result
  until: result is successful

- name: debian | installing pre-reqs
  apt:
    name:
      - apt-transport-https
      - ca-certificates
      - curl
      - gnupg-agent
      - software-properties-common
    state: present
  become: true
  register: result
  until: result is successful


- name: debian | adding docker apt-key
  apt_key:
    url: "{{ docker_ubuntu_repo_info['url'] }}"
    id: "{{ docker_ubuntu_repo_info['id'] }}"
    state: present
  become: true
  register: result
  until: result is successful

- name: debian | adding docker repo
  apt_repository:
    repo: "{{ docker_ubuntu_repo_info['repo'] }}"
    state: present
  become: true
  register: result
  until: result is successful


- name: debian | installing docker
  apt:
    name:
      - containerd.io
      - "docker-ce={{ docker_version_debian }}"
    state: present
  become: true
  register: result
  until: result is successful
  when:
    - docker_version|lower != "latest"
    - has_docker is failed

- name: debian | installing docker
  apt:
    name:
      - containerd.io
      - docker-ce
    state: present
  become: true
  register: result
  until: result is successful
  when:
    - docker_version|lower == "latest"
    - has_docker is failed
